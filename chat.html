<!-- Firebase SDK (MODERN VERSION) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getFirestore, 
    collection, 
    addDoc, 
    onSnapshot, 
    query, 
    orderBy, 
    serverTimestamp 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA-GttbP1ggsx00ecBW_TKLhUIMQugsb-A",
    authDomain: "pvt-chat-76fc4.firebaseapp.com",
    projectId: "pvt-chat-76fc4",
    storageBucket: "pvt-chat-76fc4.firebasestorage.app",
    messagingSenderId: "1067226039088",
    appId: "1:1067226039088:web:7c841ede69cb245a72fef5",
    measurementId: "G-Q71KHTJ3HY"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const correctPassword = "iloveyou"; // CHANGE THIS

  window.checkPassword = function () {
    const input = document.getElementById("password").value;
    if (input === correctPassword) {
      document.getElementById("loginBox").classList.add("hidden");
      document.getElementById("chatBox").classList.remove("hidden");
      loadMessages();
    } else {
      document.getElementById("error").innerText = "Wrong secret ðŸ˜¢";
    }
  };

  window.sendMessage = async function () {
    const username = document.getElementById("username").value;
    const message = document.getElementById("messageInput").value;

    if (username && message) {
      await addDoc(collection(db, "messages"), {
        user: username,
        text: message,
        timestamp: serverTimestamp()
      });

      document.getElementById("messageInput").value = "";
    }
  };

  function loadMessages() {
    const q = query(collection(db, "messages"), orderBy("timestamp"));

    onSnapshot(q, (snapshot) => {
      const messagesDiv = document.getElementById("messages");
      messagesDiv.innerHTML = "";

      snapshot.forEach((doc) => {
        const data = doc.data();
        const div = document.createElement("div");
        div.classList.add("msg");
        div.innerHTML = "<strong>" + data.user + ":</strong> " + data.text;
        messagesDiv.appendChild(div);
      });
    });
  }
</script>
